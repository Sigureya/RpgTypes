"use strict";const u=e=>e.map(a=>({dataKey:a,placeHolder:`{${a}}`})),b=e=>({dataKey:e.dataIdKey,placeHolder:`{${e.dataIdKey}}`,sourceId:{author:e.sourceId.author,kind:e.sourceId.kind,module:e.sourceId.module}}),i=e=>{const a=e.itemMappers??[];return e.itemMapper?[...a,e.itemMapper]:[...a]},k=e=>({placeHolder:`{${e.placeHolder}}`,kindKey:e.kindKey,dataIdKey:e.dataIdKey}),H=e=>{if(e.fallbackFormat&&e.fallbackFormat.text!==void 0)return e.fallbackFormat.text;const a=(r=>{var t,n,l;return new Set([...((t=r.placeHolder)==null?void 0:t.numbers)??[],...((n=r.placeHolder)==null?void 0:n.strings)??[],...((l=r.arrayIndex)==null?void 0:l.map(o=>o.dataIdKey))??[]])})(e);return a.size===0?"value not found":Array.from(a).map(r=>`${r}:{${r}}`).join(", ")},K=e=>{var a;return((a=e.fallbackFormat)==null?void 0:a.label)!==void 0?e.fallbackFormat.label:"unknown key:{key}"},y=(e,a,r)=>{const t=a[r.dataKey];return t==null?e:e.replaceAll(r.placeHolder,String(t))},f=(e,a,r,t,n)=>{const l=((o,d)=>{const c=((m,s)=>{const p=s[m];return p&&p.id===m?p:s.find(I=>I.id===m)})(d,o);return c?c.name:`?data[${d}]`})(t,n(a));return r.itemMappers.reduce((o,d)=>o.replaceAll(d.placeHolder,l),e)};exports.applyFormatRule=(e,a,r,t,n)=>{const l=((o,d,c)=>{const m=c.properties.numbers.reduce((s,p)=>y(s,d,p),o);return c.properties.strings.reduce((s,p)=>y(s,d,p),m)})(t,e,r);return a?f(l,e,r,a,n):l},exports.compileFormatRule=(e,a=[])=>{return{itemMappers:[...i(e),...a].map(k),fallbackFormat:{text:H(e),label:K(e)},properties:(r=e.placeHolder??{},{numbers:r.numbers?u(r.numbers):[],strings:r.strings?u(r.strings):[]}),arrayIndex:e.arrayIndex?e.arrayIndex.map(b):[]};var r},exports.getItemMappersFromRule=i,exports.getPlaceHolderKeys=e=>{var a,r,t,n;return new Set([...((a=e.placeHolder)==null?void 0:a.numbers)??[],...e.itemMapper?[e.itemMapper.placeHolder]:[],...((r=e.itemMappers)==null?void 0:r.map(l=>l.placeHolder))??[],...((t=e.placeHolder)==null?void 0:t.strings)??[],...((n=e.arrayIndex)==null?void 0:n.map(l=>l.dataIdKey))??[]])},exports.makeAudioFileParams=(e={})=>({name:e.name??"",volume:e.volume??100,pitch:e.pitch??100,pan:e.pan??0});
