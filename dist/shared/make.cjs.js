"use strict";const u=e=>e.map((a=>({dataKey:a,placeHolder:`{${a}}`}))),b=e=>({dataKey:e.dataIdKey,placeHolder:`{${e.dataIdKey}}`,sourceId:{author:e.sourceId.author,kind:e.sourceId.kind,module:e.sourceId.module}}),i=e=>{const a=e.itemMappers??[];return e.itemMapper?[...a,e.itemMapper]:[...a]},k=e=>({placeHolder:`{${e.placeHolder}}`,kindKey:e.kindKey,dataIdKey:e.dataIdKey}),H=e=>{if(e.fallbackFormat&&e.fallbackFormat.text!==void 0)return e.fallbackFormat.text;const a=(r=>new Set([...r.placeHolder?.numbers??[],...r.placeHolder?.strings??[],...r.arrayIndex?.map((t=>t.dataIdKey))??[]]))(e);return a.size===0?"value not found":Array.from(a).map((r=>`${r}:{${r}}`)).join(", ")},K=e=>e.fallbackFormat?.label!==void 0?e.fallbackFormat.label:"unknown key:{key}",y=(e,a,r)=>{const t=a[r.dataKey];return t==null?e:e.replaceAll(r.placeHolder,String(t))},f=(e,a,r,t,m)=>{const c=((d,l)=>{const p=((s,o)=>{const n=o[s];return n&&n.id===s?n:o.find((I=>I.id===s))})(l,d);return p?p.name:`?data[${l}]`})(t,m(a));return r.itemMappers.reduce(((d,l)=>d.replaceAll(l.placeHolder,c)),e)};exports.applyFormatRule=(e,a,r,t,m)=>{const c=((d,l,p)=>{const s=p.properties.numbers.reduce(((o,n)=>y(o,l,n)),d);return p.properties.strings.reduce(((o,n)=>y(o,l,n)),s)})(t,e,r);return a?f(c,e,r,a,m):c},exports.compileFormatRule=(e,a=[])=>{return{itemMappers:[...i(e),...a].map(k),fallbackFormat:{text:H(e),label:K(e)},properties:(r=e.placeHolder??{},{numbers:r.numbers?u(r.numbers):[],strings:r.strings?u(r.strings):[]}),arrayIndex:e.arrayIndex?e.arrayIndex.map(b):[]};var r},exports.getItemMappersFromRule=i,exports.getPlaceHolderKeys=e=>new Set([...e.placeHolder?.numbers??[],...e.itemMapper?[e.itemMapper.placeHolder]:[],...e.itemMappers?.map((a=>a.placeHolder))??[],...e.placeHolder?.strings??[],...e.arrayIndex?.map((a=>a.dataIdKey))??[]]),exports.makeAudioFileParams=(e={})=>({name:e.name??"",volume:e.volume??100,pitch:e.pitch??100,pan:e.pan??0});
