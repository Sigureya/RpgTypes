"use strict";var ie=Object.defineProperty;var de=(e,a,r)=>a in e?ie(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r;var k=(e,a,r)=>de(e,typeof a!="symbol"?a+"":a,r);const s=require("./commands.cjs.js"),pe=require("jsonpath-js"),le=require("@sigureya/rmmz-plugin-schema"),P=require("./mergeItemsSource.cjs.js"),H=(e,a,r)=>e.filter(t=>t.code===s.CHANGE_ARMORS||t.code===s.CHANGE_ITEMS||t.code===s.CHANGE_WEAPONS).map(t=>V(t,a,r)),ue={[s.CHANGE_WEAPONS]:"weapon",[s.CHANGE_ARMORS]:"armor",[s.CHANGE_ITEMS]:"item"},V=(e,a,r)=>{const t=s.isUsingVariableItemCommand(e)?{direct:!1,variableId:e.parameters[3]}:{direct:!0,value:e.parameters[3]},n=e.parameters[1]===s.OPERATION_GAIN?a.gain:e.parameters[1]===s.OPERATION_LOSE?a.lose:a.unknown,m=typeof e.parameters[4]=="boolean"?{includesEquip:e.parameters[4]}:{};return{itemKind:ue[e.code],dataId:s.getItemIdFromItemCommand(e),code:e.code,commandNameMZ:r(e.code),operation:n,...m,...t}},ge=e=>!!e,j=(e,a)=>e.pages.map((r,t)=>a(r,t,e)),U=(e,a)=>e.events.filter(ge).flatMap(r=>j(r,a)),ye=e=>e.conditions.itemId>0&&e.conditions.itemValid?{pageCondition:{itemId:e.conditions.itemId}}:{},R=(e,a)=>{const r=e.trimEnd(),t=a.get(r);return t?t.trimEnd():r},l=(e,a)=>{const r=e.trimEnd(),t=a(r);return t?t.trimEnd():r},y=(e,a)=>{const r=e.trimEnd(),t=a.replaceText(r);return t?t.trimEnd():r},X=(e,a)=>{switch(e.code){case s.SHOW_MESSAGE:return xe(e,a);case s.SHOW_CHOICES:return Te(e,a);case s.SHOW_MESSAGE_BODY:case s.COMMENT_HEAD:case s.COMMENT_BODY:case s.SHOW_SCROLLING_TEXT_BODY:return he(e,a);case s.CHANGE_NAME:case s.CHANGE_NICKNAME:case s.CHANGE_PROFILE:return Ne(e,a);default:return e}},he=(e,a)=>{const r=l(e.parameters[0],a);return{code:e.code,indent:e.indent,parameters:[r]}},xe=(e,a)=>{const r=e.parameters[4]?l(e.parameters[4],a):"";return s.makeCommandShowMessage({facename:e.parameters[0],faceIndex:e.parameters[1],background:e.parameters[2],positionType:e.parameters[3],speakerName:r},e.indent)},Ne=(e,a)=>{const r=l(e.parameters[1],a);return{code:e.code,indent:e.indent,parameters:[e.parameters[0],r]}},Te=(e,a)=>{const r=e.parameters[0].map(t=>l(t,a));return{code:s.SHOW_CHOICES,indent:e.indent,parameters:[r,e.parameters[1],e.parameters[2],e.parameters[3],e.parameters[4]]}},W=(e,a,r=`
`)=>s.replaceNote(e.note,t=>l(t.value,a),r),F=(e,a)=>({params:fe(e.params,r=>l(r,a)),messages:Ce(e.messages,r=>l(r,a)),basic:Ee(e.basic,r=>l(r,a)),commands:Se(e.commands,r=>l(r,a))}),Ee=(e,a)=>[a(e[0]),a(e[1]),a(e[2]),a(e[3]),a(e[4]),a(e[5]),a(e[6]),a(e[7]),a(e[8]),a(e[9])],Se=(e,a)=>[a(e[0]),a(e[1]),a(e[2]),a(e[3]),a(e[4]),a(e[5]),a(e[6]),a(e[7]),a(e[8]),a(e[9]),a(e[10]),a(e[11]),a(e[12]),a(e[13]),a(e[14]),a(e[15]),a(e[16]),a(e[17]),a(e[18]),a(e[19]),"",a(e[21]),a(e[22]),"",a(e[24]),a(e[25])],fe=(e,a)=>[a(e[0]),a(e[1]),a(e[2]),a(e[3]),a(e[4]),a(e[5]),a(e[6]),a(e[7]),a(e[8]),a(e[9])],Ce=(e,a)=>({actionFailure:a(e.actionFailure),actorDamage:a(e.actorDamage),actorDrain:a(e.actorDrain),actorGain:a(e.actorGain),actorLoss:a(e.actorLoss),actorNoDamage:a(e.actorNoDamage),actorNoHit:a(e.actorNoHit),actorRecovery:a(e.actorRecovery),alwaysDash:a(e.alwaysDash),autosave:a(e.autosave),bgmVolume:a(e.bgmVolume),bgsVolume:a(e.bgsVolume),buffAdd:a(e.buffAdd),buffRemove:a(e.buffRemove),commandRemember:a(e.commandRemember),counterAttack:a(e.counterAttack),criticalToActor:a(e.criticalToActor),criticalToEnemy:a(e.criticalToEnemy),defeat:a(e.defeat),debuffAdd:a(e.debuffAdd),emerge:a(e.emerge),enemyDamage:a(e.enemyDamage),enemyDrain:a(e.enemyDrain),enemyGain:a(e.enemyGain),enemyLoss:a(e.enemyLoss),enemyNoDamage:a(e.enemyNoDamage),enemyNoHit:a(e.enemyNoHit),enemyRecovery:a(e.enemyRecovery),escapeFailure:a(e.escapeFailure),escapeStart:a(e.escapeStart),evasion:a(e.evasion),expNext:a(e.expNext),expTotal:a(e.expTotal),file:a(e.file),loadMessage:a(e.loadMessage),levelUp:a(e.levelUp),magicEvasion:a(e.magicEvasion),magicReflection:a(e.magicReflection),meVolume:a(e.meVolume),obtainExp:a(e.obtainExp),obtainGold:a(e.obtainGold),obtainItem:a(e.obtainItem),obtainSkill:a(e.obtainSkill),partyName:a(e.partyName),possession:a(e.possession),preemptive:a(e.preemptive),saveMessage:a(e.saveMessage),seVolume:a(e.seVolume),substitute:a(e.substitute),surprise:a(e.surprise),touchUI:a(e.touchUI),useItem:a(e.useItem),victory:a(e.victory)}),O=(e,a)=>e.map(r=>l(r,a)),q=e=>e.map(a=>a.parameters[0].trimEnd()).join(`
`).trimEnd();class J{constructor(a,r){this.header=a,this.bodies=r}getBodyText(){return q(this.joinCommandBodies())}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}joinCommandBodies(){return[this.header,...this.bodies]}normalizedCommands(){return[this.mergedBody()]}}class L{constructor(a,r,t){this.bodyCode=a,this.header=r,this.bodies=t}normalizedCommands(){const a={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[a]:[a,this.mergedBody()]}getBodyText(){return q(this.bodies)}joinCommandBodies(){return this.bodies}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}const v=(e,a,r,t)=>{const n=e[a];if(!r(n))throw new Error(`Invalid head at index ${a}: ${JSON.stringify(n)}`);const m=[];for(let o=a+1;o<e.length;o++){const c=e[o];if(!t(c))break;m.push(c)}return{header:n,bodies:m}},be=(e,a)=>{const{bodies:r,header:t}=((n,m)=>v(n,m,o=>o.code===s.COMMENT_HEAD,o=>o.code===s.COMMENT_BODY))(e,a);return _e(t)?new L(s.COMMENT_BODY,t,r):new J(t,r)},_e=e=>e.parameters[0]==="選択肢ヘルプ",Ae=(e,a)=>{const{bodies:r,header:t}=((n,m)=>v(n,m,o=>o.code===s.SHOW_MESSAGE,o=>o.code===s.SHOW_MESSAGE_BODY))(e,a);return new L(s.SHOW_MESSAGE_BODY,t,r)},Ie=(e,a)=>{const{bodies:r,header:t}=((n,m)=>v(n,m,o=>o.code===s.SCRIPT_EVAL,o=>o.code===s.SCRIPT_EVAL_BODY))(e,a);return new J(t,r)},Oe=(e,a)=>{const{bodies:r,header:t}=((n,m)=>v(n,m,o=>o.code===s.SHOW_SCROLLING_TEXT,o=>o.code===s.SHOW_SCROLLING_TEXT_BODY))(e,a);return new L(s.SHOW_SCROLLING_TEXT_BODY,t,r)},Me={[s.SHOW_MESSAGE]:(e,a,r)=>r.showMessage(Ae(e,a),a,e),[s.SCRIPT_EVAL]:(e,a,r)=>r.script(Ie(e,a),a,e),[s.COMMENT_HEAD]:(e,a,r)=>r.comment(be(e,a),a,e),[s.SHOW_SCROLLING_TEXT]:(e,a,r)=>r.showScrollingText(Oe(e,a),a,e)},z=e=>Me[e],ve=e=>((a,r)=>({code:a.code,paramIndex:r,value:a.parameters[r]}))(e,1),M=(e,a)=>Z(e,a),Z=(e,a)=>e.flatMap((r,t)=>He(r,t,e,a)).filter(r=>r!==null),He=(e,a,r,t)=>{if(e.code===s.SHOW_CHOICES)return(m=>m.parameters[0].map((o,c)=>({code:102,paramIndex:c,value:o})))(e);const n=z(e.code);if(n){const m=n(r,a,De);if(m!==void 0)return[m]}return e.code===s.CHANGE_NICKNAME||e.code===s.CHANGE_NAME||e.code===s.CHANGE_PROFILE?ve(e):e.code===s.PLUGIN_COMMAND_MZ?t(e):null},De={comment:e=>{return a=e,{code:s.COMMENT_HEAD,paramIndex:0,value:a.getBodyText()};var a},showMessage:e=>{return a=e,{code:s.SHOW_MESSAGE_BODY,paramIndex:0,value:a.getBodyText(),speaker:(r=a.header,r.parameters[4]?r.parameters[4].trimEnd():"")};var a,r},script:e=>(a=>({code:s.SCRIPT_EVAL,paramIndex:0,value:a.getBodyText()}))(e),showScrollingText:e=>(a=>({code:s.SHOW_SCROLLING_TEXT_BODY,paramIndex:0,value:a.getBodyText()}))(e)},K=(e,a=()=>[])=>({eventId:e.id,commands:M(e.list,a)}),Q=(e,a=()=>[])=>e.pages.map((r,t)=>({eventId:e.id,pageIndex:t,commands:M(r.list,a)})),ee=(e,a=()=>[])=>({note:e.note,noteItems:s.readNote(e.note),displayedName:e.displayName,events:Be(e,a)}),Be=(e,a)=>U(e,(r,t,n)=>({eventId:n.id,pageIndex:t,commands:M(r.list,a),note:n.note,noteItems:s.readNote(n.note),name:n.name})),ae=e=>(a=>a.kind.endsWith("[]"))(e.attr),re=e=>e.kind==="struct",te=e=>e.attr.kind==="struct[]",Ge=e=>se[e.kind.replace("[]","")].type==="number",we=e=>se[e.kind.replace("[]","")].type==="string",A={type:"string",hasText:!0},N={type:"number",hasText:!1},x={type:"number",hasText:!1},se={string:A,number:{type:"number",hasText:!1},boolean:{type:"boolean"},armor:N,actor:N,class:N,enemy:N,skill:N,state:N,item:N,weapon:N,common_event:N,switch:N,variable:N,troop:N,multiline_string:A,file:{type:"string",hasText:!1},"file[]":{type:"string",hasText:!1},"multiline_string[]":A,"string[]":A,combo:A,select:A,any:A,struct:{type:"struct"},"actor[]":x,"enemy[]":x,"class[]":x,"skill[]":x,"state[]":x,"item[]":x,"weapon[]":x,"common_event[]":x,"troop[]":x,"armor[]":x,"switch[]":x,"variable[]":x,"number[]":x};function Le(e){return ke(e,a=>!0,a=>!0)}const ke=(e,a,r)=>{const t=[],n=[],m=[],o=[];return e.forEach(c=>{if(re(c.attr))t.push({name:c.name,attr:c.attr});else if(te(c))n.push(c);else if(ae(c)){if(r(c))return void o.push(c)}else a(c)&&m.push(c)}),{structs:t,structArrays:n,scalars:m,scalarArrays:o}};function Pe(e){const a=e.map(r=>[r.name,r.attr]);return Object.fromEntries(a)}const Re=(e,a)=>{if(e.length!==0)return`${a}[${e.map(r=>`"${r.name}"`).join(",")}]`},We=(e,a)=>e.map(r=>({path:`${a}["${r.name}"][*]`,param:r})),ne={undefinedStruct:"undefined_struct",cyclicStruct:"cyclic_struct"};function me(e,a,r,t){const n={items:[],errs:[],frames:[{schemaName:e,basePath:a,ancestry:[]}]},m=Math.max(1,3*r.size+5),o=Array.from({length:m}).reduce(c=>c.frames.length===0?c:function(i,E,S){if(i.frames.length===0)return i;const d=i.frames[i.frames.length-1],T=i.frames.slice(0,-1);if(d.ancestry.includes(d.schemaName))return{frames:T,items:i.items,errs:[...i.errs,{code:S.cyclicStruct,path:d.basePath}]};const u=E.get(d.schemaName);if(!u)return{frames:T,items:i.items,errs:[...i.errs,{code:S.undefinedStruct,path:d.basePath}]};const C=function(h,g){const p=h.ancestry.concat(h.schemaName),b=h.basePath;return[...g.structs.map(_=>({schemaName:_.attr.struct,basePath:`${b}["${_.name}"]`,ancestry:p})),...g.structArrays.map(_=>({schemaName:_.attr.struct,basePath:`${b}["${_.name}"][*]`,ancestry:p}))].reverse()}(d,u);if(u.scalars.length>0||u.scalarArrays.length>0){const h=function(g,{path:p,structName:b}){return{category:"struct",objectSchema:Pe(g.scalars),name:b,scalarArrays:We(g.scalarArrays,p),scalarsPath:g.scalars.length>0?Re(g.scalars,p):void 0}}(u,{path:d.basePath,structName:d.schemaName});return T.push(...C),{frames:T,items:[...i.items,h],errs:i.errs}}return T.push(...C),{frames:T,items:i.items,errs:i.errs}}(c,r,t),n);return{items:o.items,errors:o.errs}}const Fe=(e,a,r,t=ne)=>me(e.attr.struct,`${a}["${e.name}"]`,r,t),$e=(e,a,r,t=ne)=>me(e.attr.struct,`${a}["${e.name}"][*]`,r,t),Ye=(e,a,r,t)=>(n=>re(n.attr))(r)?Ue(e,r,t):te(r)?Xe(e,r,t):ae(r)?Ve(e,a,r):je(e,a,r),Ve=(e,a,r)=>({rootCategory:e,rootName:a,scalars:{name:"",objectSchema:{},scalarsPath:void 0,scalarArrays:[{path:`$["${r.name}"][*]`,param:r}]},structs:{items:[],errors:[]},structArrays:{items:[],errors:[]}}),je=(e,a,r)=>({rootCategory:e,rootName:a,scalars:{name:r.attr.kind,objectSchema:{[r.name]:r.attr},scalarsPath:`$["${r.name}"]`,scalarArrays:[]},structArrays:{items:[],errors:[]},structs:{items:[],errors:[]}}),Ue=(e,a,r)=>({rootName:a.name,rootCategory:e,scalars:void 0,structArrays:{items:[],errors:[]},structs:Fe(a,"$",r)}),Xe=(e,a,r)=>({structArrays:$e(a,"$",r),rootName:a.name,rootCategory:e,scalars:void 0,structs:{items:[],errors:[]}}),qe=(e,a)=>a.map(r=>Je(e,r)).flat(3),Je=(e,a)=>[a.top?D(a,e,a.top,""):[],a.structs.map(r=>D(a,e,r)),a.structArrays.map(r=>D(a,e,r))],D=(e,a,r,t=r.bundleName)=>{const n=r.scalar?((o,c,i,E,S)=>E.pathSegments(i).map(({value:d,segments:T})=>((u,C,h,g,p)=>{if(typeof h=="object"||h===null)return null;const b=g[g.length-1];if(typeof b=="number")return null;const _=p[b];return _?{rootName:u.rootName,rootType:u.rootCategory,structName:C,value:h,param:{name:b,attr:_}}:null})(o,c,d,T,S)).filter(d=>d!==null))(e,t,a,r.scalar.jsonPathJS,r.scalar.record):[],m=r.arrays.map(o=>((c,i,E,S)=>{const d=S.jsonPathJS.find(E);if(!Array.isArray(d))return[];const T=S.schema.attr;return we(T)?((u,C,h,g)=>C.filter(p=>typeof p=="string").map(p=>({rootName:u.rootName,rootType:u.rootCategory,value:p,structName:h,param:g})))(c,d,i,S.schema):Ge(T)?((u,C,h,g)=>C.filter(p=>typeof p=="number").map(p=>({rootName:u.rootName,rootType:u.rootCategory,value:p,structName:h,param:g})))(c,d,i,S.schema):[]})(e,t,a,o));return[n,m].flat(2)},B=(e,a)=>e.scalarsPath?{bundleName:e.name,arrays:$(e.scalarArrays,e.name,a),scalar:ze(e.scalarsPath,e.objectSchema,a)}:{bundleName:e.name,arrays:$(e.scalarArrays,e.name,a)},$=(e,a,r)=>e.map(t=>({jsonPathJS:r(t.path),schema:t.param,parentType:a})),ze=(e,a,r)=>({jsonPathJS:r(e),record:a}),Ze=(e,a,r,t)=>({pluginName:e,commandName:a.command,desc:a.desc??"",text:a.text??"",extractors:Ke(a,r,t)}),Ke=(e,a,r)=>e.args.map(t=>((n,m)=>{const o=n.scalars?B(n.scalars,m):void 0,c=n.structs.items.map(E=>B(E,m)),i=n.structArrays.items.map(E=>B(E,m));return{rootCategory:n.rootCategory,rootName:n.rootName,top:o,structs:c,structArrays:i}})(Ye("args",e.command,t,a),r)),Qe=(e,a)=>{const r=(t=>new Map(t.map(n=>[n.struct,Le(n.params)])))(e.schema.structs);return ea(e.pluginName,e.schema.commands,r,a)},ea=(e,a,r,t)=>a.map(n=>[`${e}:${n.command}`,Ze(e,n,r,t)]),oe=(e,a)=>{const[r,t]=e.parameters,n=`${r}:${t}`,m=a.get(n);return m?((o,c)=>({pluginName:c.pluginName,commandName:c.commandName,args:qe(o,c.extractors)}))(le.parseDeepRecord(e.parameters[3]),m):{pluginName:r,commandName:t,args:[]}};class G{constructor(a){k(this,"_commandMap");this._commandMap=a}keys(){return Array.from(this._commandMap.keys())}extractMapTexts(a){return ee(a,r=>this.extractArgs(r))}extractBattleText(a){return Q(a,r=>this.extractArgs(r))}extractCommonEventText(a){return K(a,r=>this.extractArgs(r))}extractArgs(a){const r=oe(a,this._commandMap);return r.args.filter(aa).map(t=>({code:s.PLUGIN_COMMAND_MZ,value:t.value,paramIndex:3,argName:t.param.name,argTitle:t.param.attr.text??t.param.name,commandName:r.commandName,pluginName:r.pluginName}))}extractCommandTexts(a){return M(a,r=>this.extractArgs(r))}}const aa=e=>typeof e.value=="string",w=(e,a,r)=>({folder:r,key:a,image:e[a],id:e.id}),f=(e,a)=>({note:ce(e),main:a.map(r=>({key:r,text:e[r],id:e.id}))}),ce=e=>s.readNoteEx(e.note,(a,r)=>({key:a,text:r,id:e.id})),ra=(e,a,r,t)=>{if(e.code===s.SHOW_MESSAGE_BODY||e.code===s.SHOW_SCROLLING_TEXT_BODY||e.code===s.COMMENT_BODY)return;const n=z(e.code);return n?n(r,a,t):e.code===s.SHOW_CHOICES?ta(e):e.code===s.CHANGE_NAME||e.code===s.CHANGE_NICKNAME||e.code===s.CHANGE_PROFILE?sa(e):e.code!==s.SCRIPT_EVAL_BODY?e:void 0},ta=e=>({code:s.SHOW_CHOICES,indent:e.indent,parameters:[e.parameters[0].map(a=>a.trimEnd()),e.parameters[1],e.parameters[2],e.parameters[3],e.parameters[4]]}),sa=e=>({code:e.code,indent:e.indent,parameters:[e.parameters[0],e.parameters[1].trimEnd()]}),na=e=>({code:s.SCRIPT_EVAL,indent:e.header.indent,parameters:[e.getBodyText().trimEnd()]}),ma=e=>{const a=e.getBodyText().trimEnd(),r={code:s.SHOW_MESSAGE_BODY,indent:e.header.indent,parameters:[a]};return[ca(e.header),r]},oa=e=>{const a=e.getBodyText().trimEnd(),r={code:s.SHOW_SCROLLING_TEXT_BODY,indent:e.header.indent,parameters:[a]};return[e.header,r]},ca=e=>{const a=e.parameters[4]?e.parameters[4].trimEnd():"";return{code:e.code,indent:e.indent,parameters:[e.parameters[0],e.parameters[1],e.parameters[2],e.parameters[3],a]}},I=(e,a)=>{const r=t=>a.replaceText(t);return(t=>{const n={comment:m=>m.normalizedCommands(),script:na,showMessage:ma,showScrollingText:oa};return t.map((m,o)=>m.code===s.PLUGIN_COMMAND_MZ?m:ra(m,o,t,n)).filter(m=>m!==void 0).flat()})(e).map(t=>t.code===s.PLUGIN_COMMAND_MZ?a.pluginCommand(t):t.code===s.SCRIPT_EVAL?a.scriptCommand(t):X(t,r))},Y=(e,a)=>({note:s.replaceNoteWithHandlers(e.note,a),displayName:y(e.displayName,a),events:e.events.map(r=>r?((t,n)=>({id:t.id,name:t.name,x:t.x,y:t.y,note:s.replaceNoteWithHandlers(t.note,n),pages:t.pages.map(m=>({...m,list:I(m.list,n)}))}))(r,a):null),data:e.data,tilesetId:e.tilesetId,encounterStep:e.encounterStep,scrollType:e.scrollType,specifyBattleback:e.specifyBattleback,autoplayBgm:e.autoplayBgm,autoplayBgs:e.autoplayBgs,battleback1Name:e.battleback1Name,battleback2Name:e.battleback2Name,bgm:e.bgm,bgs:e.bgs,disableDashing:e.disableDashing,encounterList:e.encounterList,height:e.height,width:e.width,parallaxLoopX:e.parallaxLoopX,parallaxLoopY:e.parallaxLoopY,parallaxName:e.parallaxName,parallaxShow:e.parallaxShow,parallaxSx:e.parallaxSx,parallaxSy:e.parallaxSy});exports.buildReferenceItemSources=(e,a,r,t,n,m)=>[...s.defineTraitItems(r,t),...s.defineGameDataSources(e,a),...s.defineSystemItems(n,m)],exports.compileItemEffectDisplayData=(e,a,r)=>{const t=s.resolveItemEffectLabels(a);return P.mergeItemsSource(r?[...t,...r]:t,e)},exports.compileTraitDisplayData=(e,a)=>P.mergeItemsSource(s.resolveTraitLabels(a),e),exports.createTextDataExtractor=()=>new G(new Map),exports.createTextDataExtractorFromCommandItems=e=>{const a=new Map(e);return new G(a)},exports.createTextDataExtractorFromSchemas=e=>{const a=e.flatMap(r=>Qe(r,t=>new pe.JSONPathJS(t)));return new G(new Map(a))},exports.extractBattleEventTexts=Q,exports.extractCommonEventTexts=K,exports.extractImageFromActor=e=>[w(e,"faceName","faces"),w(e,"characterName","characters"),w(e,"battlerName","sv_actors")],exports.extractImageFromEnemy=e=>({key:"battlerName",image:e.battlerName,id:e.id}),exports.extractItemChangeData=V,exports.extractItemCommands=H,exports.extractItemFromMap=(e,a,r)=>U(e.map,(t,n,m)=>({...ye(t),commands:H(t.list,a,r),eventName:m.name,pageIndex:n})),exports.extractItemFromTroop=(e,a,r)=>{return t=(n,m,o)=>({commands:H(n.list,a,r),eventName:o.name,troopId:o.id,pageIndex:m}),e.flatMap(n=>j(n,t));var t},exports.extractMapText=ee,exports.extractNoteText=ce,exports.extractPluginCommandMzArgs=oe,exports.extractTextData=f,exports.extractTextFromActor=e=>f(e,["name","nickname","profile"]),exports.extractTextFromArmor=e=>f(e,["name","description"]),exports.extractTextFromClass=e=>f(e,["name"]),exports.extractTextFromEnemy=e=>f(e,["name"]),exports.extractTextFromEventCommands=e=>Z(e,()=>[]),exports.extractTextFromEventCommandsEx=M,exports.extractTextFromItem=e=>f(e,["name","description"]),exports.extractTextFromSkill=e=>f(e,["name","description","message1","message2"]),exports.extractTextFromState=e=>f(e,["name","message1","message2","message3","message4"]),exports.extractTextFromSystem=e=>({gameTitle:e.gameTitle,currencyUnit:e.currencyUnit,equipTypes:[...e.equipTypes],armorTypes:[...e.armorTypes],weaponTypes:[...e.weaponTypes],terms:{basic:s.makeTermsBasicFromArray(e.terms.basic),commands:s.makeTermsCommandFromArray(e.terms.commands),messages:s.makeTermsMessages(e.terms.messages),params:s.makeParamNamesFromArray(e.terms.params)}}),exports.extractTextFromWeapon=e=>f(e,["name","description"]),exports.replaceActorText=(e,a)=>{const r=c=>a.replaceText(c),t=s.replaceNoteWithHandlers(e.note,a),n=l(e.name,r),m=l(e.nickname,r),o=l(e.profile,r);return{...e,name:n,nickname:m,profile:o,note:t}},exports.replaceBasicEventCommandTexts=X,exports.replaceClassText=(e,a)=>{const r=s.replaceNoteWithHandlers(e.note,a),t=y(e.name,a);return{...e,name:t,note:r}},exports.replaceCommonEventData=(e,a)=>({id:e.id,name:e.name,trigger:e.trigger,switchId:e.switchId,list:I(e.list,a)}),exports.replaceCommonEventTexts=(e,a)=>({id:e.id,name:e.name,trigger:e.trigger,switchId:e.switchId,list:I(e.list,{pluginCommand:r=>r,scriptCommand:r=>r,replaceText:a})}),exports.replaceEnemyText=(e,a)=>{const r=s.replaceNoteWithHandlers(e.note,a),t=y(e.name,a);return{...e,name:t,note:r}},exports.replaceEventCommandTexts=I,exports.replaceItemText=(e,a)=>{const r=s.replaceNoteWithHandlers(e.note,a),t=y(e.name,a),n=y(e.description,a);return{...e,name:t,description:n,note:r}},exports.replaceMapData=(e,a)=>Y(e,a),exports.replaceMapTexts=(e,a)=>Y(e,{pluginCommand:r=>r,scriptCommand:r=>r,replaceText:a,isReplaceTargetNote:()=>!1}),exports.replaceNoteTextByFunction=W,exports.replaceNoteTextByMap=(e,a,r=`
`)=>W(e,t=>a.get(t),r),exports.replaceSkillText=(e,a)=>{const r=s.replaceNoteWithHandlers(e.note,a),t=y(e.name,a),n=y(e.description,a),m=y(e.message1,a),o=y(e.message2,a);return{...e,name:t,description:n,message1:m,message2:o,note:r}},exports.replaceStateText=(e,a)=>{const r=s.replaceNoteWithHandlers(e.note,a),t=y(e.name,a),n=y(e.message1,a),m=y(e.message2,a),o=y(e.message3,a),c=y(e.message4,a);return{...e,name:t,message1:n,message2:m,message3:o,message4:c,note:r}},exports.replaceSystemTermsByMap=(e,a)=>F(e,r=>R(r,a)),exports.replaceSystemText=(e,a)=>({...e,gameTitle:l(e.gameTitle,a),currencyUnit:l(e.currencyUnit,a),elements:O(e.elements,a),skillTypes:O(e.skillTypes,a),weaponTypes:O(e.weaponTypes,a),armorTypes:O(e.armorTypes,a),equipTypes:O(e.equipTypes,a),terms:F(e.terms,a)}),exports.replaceTextByMap=R,exports.replaceTroopData=(e,a)=>({members:e.members,id:e.id,name:e.name,pages:e.pages.map(r=>({conditions:r.conditions,span:r.span,list:I(r.list,a)}))}),exports.replaceTroopTexts=(e,a)=>{const r={pluginCommand:t=>t,scriptCommand:t=>t,replaceText:a};return{members:e.members,id:e.id,name:e.name,pages:e.pages.map(t=>({conditions:t.conditions,span:t.span,list:I(t.list,r)}))}};
