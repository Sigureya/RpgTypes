"use strict";const i=require("./commands.cjs.js"),n=require("./eventCommandCodes.cjs.js"),ie=require("jsonpath-js"),de=require("@sigureya/rmmz-plugin-schema"),P=require("./mergeItemsSource.cjs.js"),D=(e,a,r)=>e.filter((t=>t.code===n.CHANGE_ARMORS||t.code===n.CHANGE_ITEMS||t.code===n.CHANGE_WEAPONS)).map((t=>V(t,a,r))),pe={[n.CHANGE_WEAPONS]:"weapon",[n.CHANGE_ARMORS]:"armor",[n.CHANGE_ITEMS]:"item"},V=(e,a,r)=>{const t=i.isUsingVariableItemCommand(e)?{direct:!1,variableId:e.parameters[3]}:{direct:!0,value:e.parameters[3]},s=e.parameters[1]===i.OPERATION_GAIN?a.gain:e.parameters[1]===i.OPERATION_LOSE?a.lose:a.unknown,m=typeof e.parameters[4]=="boolean"?{includesEquip:e.parameters[4]}:{};return{itemKind:pe[e.code],dataId:i.getItemIdFromItemCommand(e),code:e.code,commandNameMZ:r(e.code),operation:s,...m,...t}},le=e=>!!e,j=(e,a)=>e.pages.map(((r,t)=>a(r,t,e))),U=(e,a)=>e.events.filter(le).flatMap((r=>j(r,a))),ue=e=>e.conditions.itemId>0&&e.conditions.itemValid?{pageCondition:{itemId:e.conditions.itemId}}:{},R=(e,a)=>{const r=e.trimEnd(),t=a.get(r);return t?t.trimEnd():r},u=(e,a)=>{const r=e.trimEnd(),t=a(r);return t?t.trimEnd():r},h=(e,a)=>{const r=e.trimEnd(),t=a.replaceText(r);return t?t.trimEnd():r},q=(e,a)=>{switch(e.code){case n.SHOW_MESSAGE:return ye(e,a);case n.SHOW_CHOICES:return xe(e,a);case n.SHOW_MESSAGE_BODY:case n.COMMENT_HEAD:case n.COMMENT_BODY:case n.SHOW_SCROLLING_TEXT_BODY:return ge(e,a);case n.CHANGE_NAME:case n.CHANGE_NICKNAME:case n.CHANGE_PROFILE:return he(e,a);default:return e}},ge=(e,a)=>{const r=u(e.parameters[0],a);return{code:e.code,indent:e.indent,parameters:[r]}},ye=(e,a)=>{const r=e.parameters[4]?u(e.parameters[4],a):"";return i.makeCommandShowMessage({facename:e.parameters[0],faceIndex:e.parameters[1],background:e.parameters[2],positionType:e.parameters[3],speakerName:r},e.indent)},he=(e,a)=>{const r=u(e.parameters[1],a);return{code:e.code,indent:e.indent,parameters:[e.parameters[0],r]}},xe=(e,a)=>{const r=e.parameters[0].map((t=>u(t,a)));return{code:n.SHOW_CHOICES,indent:e.indent,parameters:[r,e.parameters[1],e.parameters[2],e.parameters[3],e.parameters[4]]}},W=(e,a,r=`
`)=>i.replaceNote(e.note,(t=>u(t.value,a)),r),F=(e,a)=>({params:Ee(e.params,(r=>u(r,a))),messages:Se(e.messages,(r=>u(r,a))),basic:Ne(e.basic,(r=>u(r,a))),commands:Te(e.commands,(r=>u(r,a)))}),Ne=(e,a)=>[a(e[0]),a(e[1]),a(e[2]),a(e[3]),a(e[4]),a(e[5]),a(e[6]),a(e[7]),a(e[8]),a(e[9])],Te=(e,a)=>[a(e[0]),a(e[1]),a(e[2]),a(e[3]),a(e[4]),a(e[5]),a(e[6]),a(e[7]),a(e[8]),a(e[9]),a(e[10]),a(e[11]),a(e[12]),a(e[13]),a(e[14]),a(e[15]),a(e[16]),a(e[17]),a(e[18]),a(e[19]),"",a(e[21]),a(e[22]),"",a(e[24]),a(e[25])],Ee=(e,a)=>[a(e[0]),a(e[1]),a(e[2]),a(e[3]),a(e[4]),a(e[5]),a(e[6]),a(e[7]),a(e[8]),a(e[9])],Se=(e,a)=>({actionFailure:a(e.actionFailure),actorDamage:a(e.actorDamage),actorDrain:a(e.actorDrain),actorGain:a(e.actorGain),actorLoss:a(e.actorLoss),actorNoDamage:a(e.actorNoDamage),actorNoHit:a(e.actorNoHit),actorRecovery:a(e.actorRecovery),alwaysDash:a(e.alwaysDash),autosave:a(e.autosave),bgmVolume:a(e.bgmVolume),bgsVolume:a(e.bgsVolume),buffAdd:a(e.buffAdd),buffRemove:a(e.buffRemove),commandRemember:a(e.commandRemember),counterAttack:a(e.counterAttack),criticalToActor:a(e.criticalToActor),criticalToEnemy:a(e.criticalToEnemy),defeat:a(e.defeat),debuffAdd:a(e.debuffAdd),emerge:a(e.emerge),enemyDamage:a(e.enemyDamage),enemyDrain:a(e.enemyDrain),enemyGain:a(e.enemyGain),enemyLoss:a(e.enemyLoss),enemyNoDamage:a(e.enemyNoDamage),enemyNoHit:a(e.enemyNoHit),enemyRecovery:a(e.enemyRecovery),escapeFailure:a(e.escapeFailure),escapeStart:a(e.escapeStart),evasion:a(e.evasion),expNext:a(e.expNext),expTotal:a(e.expTotal),file:a(e.file),loadMessage:a(e.loadMessage),levelUp:a(e.levelUp),magicEvasion:a(e.magicEvasion),magicReflection:a(e.magicReflection),meVolume:a(e.meVolume),obtainExp:a(e.obtainExp),obtainGold:a(e.obtainGold),obtainItem:a(e.obtainItem),obtainSkill:a(e.obtainSkill),partyName:a(e.partyName),possession:a(e.possession),preemptive:a(e.preemptive),saveMessage:a(e.saveMessage),seVolume:a(e.seVolume),substitute:a(e.substitute),surprise:a(e.surprise),touchUI:a(e.touchUI),useItem:a(e.useItem),victory:a(e.victory)}),M=(e,a)=>e.map((r=>u(r,a))),X=e=>e.map((a=>a.parameters[0].trimEnd())).join(`
`).trimEnd();class J{constructor(a,r){this.header=a,this.bodies=r}getBodyText(){return X(this.joinCommandBodies())}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}joinCommandBodies(){return[this.header,...this.bodies]}normalizedCommands(){return[this.mergedBody()]}}class k{constructor(a,r,t){this.bodyCode=a,this.header=r,this.bodies=t}normalizedCommands(){const a={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[a]:[a,this.mergedBody()]}getBodyText(){return X(this.bodies)}joinCommandBodies(){return this.bodies}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}const H=(e,a,r,t)=>{const s=e[a];if(!r(s))throw new Error(`Invalid head at index ${a}: ${JSON.stringify(s)}`);const m=[];for(let o=a+1;o<e.length;o++){const c=e[o];if(!t(c))break;m.push(c)}return{header:s,bodies:m}},fe=(e,a)=>{const{bodies:r,header:t}=((s,m)=>H(s,m,(o=>o.code===n.COMMENT_HEAD),(o=>o.code===n.COMMENT_BODY)))(e,a);return Ce(t)?new k(n.COMMENT_BODY,t,r):new J(t,r)},Ce=e=>e.parameters[0]==="選択肢ヘルプ",be=(e,a)=>{const{bodies:r,header:t}=((s,m)=>H(s,m,(o=>o.code===n.SHOW_MESSAGE),(o=>o.code===n.SHOW_MESSAGE_BODY)))(e,a);return new k(n.SHOW_MESSAGE_BODY,t,r)},_e=(e,a)=>{const{bodies:r,header:t}=((s,m)=>H(s,m,(o=>o.code===n.SCRIPT_EVAL),(o=>o.code===n.SCRIPT_EVAL_BODY)))(e,a);return new J(t,r)},Ae=(e,a)=>{const{bodies:r,header:t}=((s,m)=>H(s,m,(o=>o.code===n.SHOW_SCROLLING_TEXT),(o=>o.code===n.SHOW_SCROLLING_TEXT_BODY)))(e,a);return new k(n.SHOW_SCROLLING_TEXT_BODY,t,r)},Ie={[n.SHOW_MESSAGE]:(e,a,r)=>r.showMessage(be(e,a),a,e),[n.SCRIPT_EVAL]:(e,a,r)=>r.script(_e(e,a),a,e),[n.COMMENT_HEAD]:(e,a,r)=>r.comment(fe(e,a),a,e),[n.SHOW_SCROLLING_TEXT]:(e,a,r)=>r.showScrollingText(Ae(e,a),a,e)},z=e=>Ie[e],Oe=e=>((a,r)=>({code:a.code,paramIndex:r,value:a.parameters[r]}))(e,1),v=(e,a)=>Z(e,a),Z=(e,a)=>e.flatMap(((r,t)=>Me(r,t,e,a))).filter((r=>r!==null)),Me=(e,a,r,t)=>{if(e.code===n.SHOW_CHOICES)return(m=>m.parameters[0].map(((o,c)=>({code:102,paramIndex:c,value:o}))))(e);const s=z(e.code);if(s){const m=s(r,a,ve);if(m!==void 0)return[m]}return e.code===n.CHANGE_NICKNAME||e.code===n.CHANGE_NAME||e.code===n.CHANGE_PROFILE?Oe(e):e.code===n.PLUGIN_COMMAND_MZ?t(e):null},ve={comment:e=>{return a=e,{code:n.COMMENT_HEAD,paramIndex:0,value:a.getBodyText()};var a},showMessage:e=>{return a=e,{code:n.SHOW_MESSAGE_BODY,paramIndex:0,value:a.getBodyText(),speaker:(r=a.header,r.parameters[4]?r.parameters[4].trimEnd():"")};var a,r},script:e=>(a=>({code:n.SCRIPT_EVAL,paramIndex:0,value:a.getBodyText()}))(e),showScrollingText:e=>(a=>({code:n.SHOW_SCROLLING_TEXT_BODY,paramIndex:0,value:a.getBodyText()}))(e)},K=(e,a=()=>[])=>({eventId:e.id,commands:v(e.list,a)}),Q=(e,a=()=>[])=>e.pages.map(((r,t)=>({eventId:e.id,pageIndex:t,commands:v(r.list,a)}))),ee=(e,a=()=>[])=>({note:e.note,noteItems:i.readNote(e.note),displayedName:e.displayName,events:He(e,a)}),He=(e,a)=>U(e,((r,t,s)=>({eventId:s.id,pageIndex:t,commands:v(r.list,a),note:s.note,noteItems:i.readNote(s.note),name:s.name}))),ae=e=>(a=>a.kind.endsWith("[]"))(e.attr),re=e=>e.kind==="struct",te=e=>e.attr.kind==="struct[]",De=e=>se[e.kind.replace("[]","")].type==="number",Be=e=>se[e.kind.replace("[]","")].type==="string",I={type:"string",hasText:!0},T={type:"number",hasText:!1},N={type:"number",hasText:!1},se={string:I,number:{type:"number",hasText:!1},boolean:{type:"boolean"},armor:T,actor:T,class:T,enemy:T,skill:T,state:T,item:T,weapon:T,common_event:T,switch:T,variable:T,troop:T,multiline_string:I,file:{type:"string",hasText:!1},"file[]":{type:"string",hasText:!1},"multiline_string[]":I,"string[]":I,combo:I,select:I,any:I,struct:{type:"struct"},"actor[]":N,"enemy[]":N,"class[]":N,"skill[]":N,"state[]":N,"item[]":N,"weapon[]":N,"common_event[]":N,"troop[]":N,"armor[]":N,"switch[]":N,"variable[]":N,"number[]":N};function Ge(e){return we(e,(a=>!0),(a=>!0))}const we=(e,a,r)=>{const t=[],s=[],m=[],o=[];return e.forEach((c=>{if(re(c.attr))t.push({name:c.name,attr:c.attr});else if(te(c))s.push(c);else if(ae(c)){if(r(c))return void o.push(c)}else a(c)&&m.push(c)})),{structs:t,structArrays:s,scalars:m,scalarArrays:o}};function Le(e){const a=e.map((r=>[r.name,r.attr]));return Object.fromEntries(a)}const ke=(e,a)=>{if(e.length!==0)return`${a}[${e.map((r=>`"${r.name}"`)).join(",")}]`},Pe=(e,a)=>e.map((r=>({path:`${a}["${r.name}"][*]`,param:r}))),ne={undefinedStruct:"undefined_struct",cyclicStruct:"cyclic_struct"};function me(e,a,r,t){const s={items:[],errs:[],frames:[{schemaName:e,basePath:a,ancestry:[]}]},m=Math.max(1,3*r.size+5),o=Array.from({length:m}).reduce((c=>c.frames.length===0?c:(function(d,S,f){if(d.frames.length===0)return d;const p=d.frames[d.frames.length-1],E=d.frames.slice(0,-1);if(p.ancestry.includes(p.schemaName))return{frames:E,items:d.items,errs:[...d.errs,{code:f.cyclicStruct,path:p.basePath}]};const g=S.get(p.schemaName);if(!g)return{frames:E,items:d.items,errs:[...d.errs,{code:f.undefinedStruct,path:p.basePath}]};const b=(function(x,y){const l=x.ancestry.concat(x.schemaName),_=x.basePath;return[...y.structs.map((A=>({schemaName:A.attr.struct,basePath:`${_}["${A.name}"]`,ancestry:l}))),...y.structArrays.map((A=>({schemaName:A.attr.struct,basePath:`${_}["${A.name}"][*]`,ancestry:l})))].reverse()})(p,g);if(g.scalars.length>0||g.scalarArrays.length>0){const x=(function(y,{path:l,structName:_}){return{category:"struct",objectSchema:Le(y.scalars),name:_,scalarArrays:Pe(y.scalarArrays,l),scalarsPath:y.scalars.length>0?ke(y.scalars,l):void 0}})(g,{path:p.basePath,structName:p.schemaName});return E.push(...b),{frames:E,items:[...d.items,x],errs:d.errs}}return E.push(...b),{frames:E,items:d.items,errs:d.errs}})(c,r,t)),s);return{items:o.items,errors:o.errs}}const Re=(e,a,r,t=ne)=>me(e.attr.struct,`${a}["${e.name}"]`,r,t),We=(e,a,r,t=ne)=>me(e.attr.struct,`${a}["${e.name}"][*]`,r,t),Fe=(e,a,r,t)=>(s=>re(s.attr))(r)?Ve(e,r,t):te(r)?je(e,r,t):ae(r)?$e(e,a,r):Ye(e,a,r),$e=(e,a,r)=>({rootCategory:e,rootName:a,scalars:{name:"",objectSchema:{},scalarsPath:void 0,scalarArrays:[{path:`$["${r.name}"][*]`,param:r}]},structs:{items:[],errors:[]},structArrays:{items:[],errors:[]}}),Ye=(e,a,r)=>({rootCategory:e,rootName:a,scalars:{name:r.attr.kind,objectSchema:{[r.name]:r.attr},scalarsPath:`$["${r.name}"]`,scalarArrays:[]},structArrays:{items:[],errors:[]},structs:{items:[],errors:[]}}),Ve=(e,a,r)=>({rootName:a.name,rootCategory:e,scalars:void 0,structArrays:{items:[],errors:[]},structs:Re(a,"$",r)}),je=(e,a,r)=>({structArrays:We(a,"$",r),rootName:a.name,rootCategory:e,scalars:void 0,structs:{items:[],errors:[]}}),Ue=(e,a)=>a.map((r=>qe(e,r))).flat(3),qe=(e,a)=>[a.top?B(a,e,a.top,""):[],a.structs.map((r=>B(a,e,r))),a.structArrays.map((r=>B(a,e,r)))],B=(e,a,r,t=r.bundleName)=>{const s=r.scalar?((o,c,d,S,f)=>S.pathSegments(d).map((({value:p,segments:E})=>((g,b,x,y,l)=>{if(typeof x=="object"||x===null)return null;const _=y[y.length-1];if(typeof _=="number")return null;const A=l[_];return A?{rootName:g.rootName,rootType:g.rootCategory,structName:b,value:x,param:{name:_,attr:A}}:null})(o,c,p,E,f))).filter((p=>p!==null)))(e,t,a,r.scalar.jsonPathJS,r.scalar.record):[],m=r.arrays.map((o=>((c,d,S,f)=>{const p=f.jsonPathJS.find(S);if(!Array.isArray(p))return[];const E=f.schema.attr;return Be(E)?((g,b,x,y)=>b.filter((l=>typeof l=="string")).map((l=>({rootName:g.rootName,rootType:g.rootCategory,value:l,structName:x,param:y}))))(c,p,d,f.schema):De(E)?((g,b,x,y)=>b.filter((l=>typeof l=="number")).map((l=>({rootName:g.rootName,rootType:g.rootCategory,value:l,structName:x,param:y}))))(c,p,d,f.schema):[]})(e,t,a,o)));return[s,m].flat(2)},G=(e,a)=>e.scalarsPath?{bundleName:e.name,arrays:$(e.scalarArrays,e.name,a),scalar:Xe(e.scalarsPath,e.objectSchema,a)}:{bundleName:e.name,arrays:$(e.scalarArrays,e.name,a)},$=(e,a,r)=>e.map((t=>({jsonPathJS:r(t.path),schema:t.param,parentType:a}))),Xe=(e,a,r)=>({jsonPathJS:r(e),record:a}),Je=(e,a,r,t)=>({pluginName:e,commandName:a.command,desc:a.desc??"",text:a.text??"",extractors:ze(a,r,t)}),ze=(e,a,r)=>e.args.map((t=>((s,m)=>{const o=s.scalars?G(s.scalars,m):void 0,c=s.structs.items.map((S=>G(S,m))),d=s.structArrays.items.map((S=>G(S,m)));return{rootCategory:s.rootCategory,rootName:s.rootName,top:o,structs:c,structArrays:d}})(Fe("args",e.command,t,a),r))),Ze=(e,a)=>{const r=(t=>new Map(t.map((s=>[s.struct,Ge(s.params)]))))(e.schema.structs);return Ke(e.pluginName,e.schema.commands,r,a)},Ke=(e,a,r,t)=>a.map((s=>[`${e}:${s.command}`,Je(e,s,r,t)])),oe=(e,a)=>{const[r,t]=e.parameters,s=`${r}:${t}`,m=a.get(s);return m?((o,c)=>({pluginName:c.pluginName,commandName:c.commandName,args:Ue(o,c.extractors)}))(de.parseDeepRecord(e.parameters[3]),m):{pluginName:r,commandName:t,args:[]}};class w{_commandMap;constructor(a){this._commandMap=a}keys(){return Array.from(this._commandMap.keys())}extractMapTexts(a){return ee(a,(r=>this.extractArgs(r)))}extractBattleText(a){return Q(a,(r=>this.extractArgs(r)))}extractCommonEventText(a){return K(a,(r=>this.extractArgs(r)))}extractArgs(a){const r=oe(a,this._commandMap);return r.args.filter(Qe).map((t=>({code:n.PLUGIN_COMMAND_MZ,value:t.value,paramIndex:3,argName:t.param.name,argTitle:t.param.attr.text??t.param.name,commandName:r.commandName,pluginName:r.pluginName})))}extractCommandTexts(a){return v(a,(r=>this.extractArgs(r)))}}const Qe=e=>typeof e.value=="string",L=(e,a,r)=>({folder:r,key:a,image:e[a],id:e.id}),C=(e,a)=>({note:ce(e),main:a.map((r=>({key:r,text:e[r],id:e.id})))}),ce=e=>i.readNoteEx(e.note,((a,r)=>({key:a,text:r,id:e.id}))),ea=(e,a,r,t)=>{if(e.code===n.SHOW_MESSAGE_BODY||e.code===n.SHOW_SCROLLING_TEXT_BODY||e.code===n.COMMENT_BODY)return;const s=z(e.code);return s?s(r,a,t):e.code===n.SHOW_CHOICES?aa(e):e.code===n.CHANGE_NAME||e.code===n.CHANGE_NICKNAME||e.code===n.CHANGE_PROFILE?ra(e):e.code!==n.SCRIPT_EVAL_BODY?e:void 0},aa=e=>({code:n.SHOW_CHOICES,indent:e.indent,parameters:[e.parameters[0].map((a=>a.trimEnd())),e.parameters[1],e.parameters[2],e.parameters[3],e.parameters[4]]}),ra=e=>({code:e.code,indent:e.indent,parameters:[e.parameters[0],e.parameters[1].trimEnd()]}),ta=e=>({code:n.SCRIPT_EVAL,indent:e.header.indent,parameters:[e.getBodyText().trimEnd()]}),sa=e=>{const a=e.getBodyText().trimEnd(),r={code:n.SHOW_MESSAGE_BODY,indent:e.header.indent,parameters:[a]};return[ma(e.header),r]},na=e=>{const a=e.getBodyText().trimEnd(),r={code:n.SHOW_SCROLLING_TEXT_BODY,indent:e.header.indent,parameters:[a]};return[e.header,r]},ma=e=>{const a=e.parameters[4]?e.parameters[4].trimEnd():"";return{code:e.code,indent:e.indent,parameters:[e.parameters[0],e.parameters[1],e.parameters[2],e.parameters[3],a]}},O=(e,a)=>{const r=t=>a.replaceText(t);return(t=>{const s={comment:m=>m.normalizedCommands(),script:ta,showMessage:sa,showScrollingText:na};return t.map(((m,o)=>m.code===n.PLUGIN_COMMAND_MZ?m:ea(m,o,t,s))).filter((m=>m!==void 0)).flat()})(e).map((t=>t.code===n.PLUGIN_COMMAND_MZ?a.pluginCommand(t):t.code===n.SCRIPT_EVAL?a.scriptCommand(t):q(t,r)))},Y=(e,a)=>({note:i.replaceNoteWithHandlers(e.note,a),displayName:h(e.displayName,a),events:e.events.map((r=>r?((t,s)=>({id:t.id,name:t.name,x:t.x,y:t.y,note:i.replaceNoteWithHandlers(t.note,s),pages:t.pages.map((m=>({...m,list:O(m.list,s)})))}))(r,a):null)),data:e.data,tilesetId:e.tilesetId,encounterStep:e.encounterStep,scrollType:e.scrollType,specifyBattleback:e.specifyBattleback,autoplayBgm:e.autoplayBgm,autoplayBgs:e.autoplayBgs,battleback1Name:e.battleback1Name,battleback2Name:e.battleback2Name,bgm:e.bgm,bgs:e.bgs,disableDashing:e.disableDashing,encounterList:e.encounterList,height:e.height,width:e.width,parallaxLoopX:e.parallaxLoopX,parallaxLoopY:e.parallaxLoopY,parallaxName:e.parallaxName,parallaxShow:e.parallaxShow,parallaxSx:e.parallaxSx,parallaxSy:e.parallaxSy});exports.buildReferenceItemSources=(e,a,r,t,s,m)=>[...i.defineTraitItems(r,t),...i.defineGameDataSources(e,a),...i.defineSystemItems(s,m)],exports.compileItemEffectDisplayData=(e,a,r)=>{const t=i.resolveItemEffectLabels(a);return P.mergeItemsSource(r?[...t,...r]:t,e)},exports.compileTraitDisplayData=(e,a)=>P.mergeItemsSource(i.resolveTraitLabels(a),e),exports.createTextDataExtractor=()=>new w(new Map),exports.createTextDataExtractorFromCommandItems=e=>{const a=new Map(e);return new w(a)},exports.createTextDataExtractorFromSchemas=e=>{const a=e.flatMap((r=>Ze(r,(t=>new ie.JSONPathJS(t)))));return new w(new Map(a))},exports.extractBattleEventTexts=Q,exports.extractCommonEventTexts=K,exports.extractImageFromActor=e=>[L(e,"faceName","faces"),L(e,"characterName","characters"),L(e,"battlerName","sv_actors")],exports.extractImageFromEnemy=e=>({key:"battlerName",image:e.battlerName,id:e.id}),exports.extractItemChangeData=V,exports.extractItemCommands=D,exports.extractItemFromMap=(e,a,r)=>U(e.map,((t,s,m)=>({...ue(t),commands:D(t.list,a,r),eventName:m.name,pageIndex:s}))),exports.extractItemFromTroop=(e,a,r)=>{return t=(s,m,o)=>({commands:D(s.list,a,r),eventName:o.name,troopId:o.id,pageIndex:m}),e.flatMap((s=>j(s,t)));var t},exports.extractMapText=ee,exports.extractNoteText=ce,exports.extractPluginCommandMzArgs=oe,exports.extractTextData=C,exports.extractTextFromActor=e=>C(e,["name","nickname","profile"]),exports.extractTextFromArmor=e=>C(e,["name","description"]),exports.extractTextFromClass=e=>C(e,["name"]),exports.extractTextFromEnemy=e=>C(e,["name"]),exports.extractTextFromEventCommands=e=>Z(e,(()=>[])),exports.extractTextFromEventCommandsEx=v,exports.extractTextFromItem=e=>C(e,["name","description"]),exports.extractTextFromSkill=e=>C(e,["name","description","message1","message2"]),exports.extractTextFromState=e=>C(e,["name","message1","message2","message3","message4"]),exports.extractTextFromSystem=e=>({gameTitle:e.gameTitle,currencyUnit:e.currencyUnit,equipTypes:[...e.equipTypes],armorTypes:[...e.armorTypes],weaponTypes:[...e.weaponTypes],terms:{basic:i.makeTermsBasicFromArray(e.terms.basic),commands:i.makeTermsCommandFromArray(e.terms.commands),messages:i.makeTermsMessages(e.terms.messages),params:i.makeParamNamesFromArray(e.terms.params)}}),exports.extractTextFromWeapon=e=>C(e,["name","description"]),exports.replaceActorText=(e,a)=>{const r=c=>a.replaceText(c),t=i.replaceNoteWithHandlers(e.note,a),s=u(e.name,r),m=u(e.nickname,r),o=u(e.profile,r);return{...e,name:s,nickname:m,profile:o,note:t}},exports.replaceBasicEventCommandTexts=q,exports.replaceClassText=(e,a)=>{const r=i.replaceNoteWithHandlers(e.note,a),t=h(e.name,a);return{...e,name:t,note:r}},exports.replaceCommonEventData=(e,a)=>({id:e.id,name:e.name,trigger:e.trigger,switchId:e.switchId,list:O(e.list,a)}),exports.replaceCommonEventTexts=(e,a)=>({id:e.id,name:e.name,trigger:e.trigger,switchId:e.switchId,list:O(e.list,{pluginCommand:r=>r,scriptCommand:r=>r,replaceText:a})}),exports.replaceEnemyText=(e,a)=>{const r=i.replaceNoteWithHandlers(e.note,a),t=h(e.name,a);return{...e,name:t,note:r}},exports.replaceEventCommandTexts=O,exports.replaceItemText=(e,a)=>{const r=i.replaceNoteWithHandlers(e.note,a),t=h(e.name,a),s=h(e.description,a);return{...e,name:t,description:s,note:r}},exports.replaceMapData=(e,a)=>Y(e,a),exports.replaceMapTexts=(e,a)=>Y(e,{pluginCommand:r=>r,scriptCommand:r=>r,replaceText:a,isReplaceTargetNote:()=>!1}),exports.replaceNoteTextByFunction=W,exports.replaceNoteTextByMap=(e,a,r=`
`)=>W(e,(t=>a.get(t)),r),exports.replaceSkillText=(e,a)=>{const r=i.replaceNoteWithHandlers(e.note,a),t=h(e.name,a),s=h(e.description,a),m=h(e.message1,a),o=h(e.message2,a);return{...e,name:t,description:s,message1:m,message2:o,note:r}},exports.replaceStateText=(e,a)=>{const r=i.replaceNoteWithHandlers(e.note,a),t=h(e.name,a),s=h(e.message1,a),m=h(e.message2,a),o=h(e.message3,a),c=h(e.message4,a);return{...e,name:t,message1:s,message2:m,message3:o,message4:c,note:r}},exports.replaceSystemTermsByMap=(e,a)=>F(e,(r=>R(r,a))),exports.replaceSystemText=(e,a)=>({...e,gameTitle:u(e.gameTitle,a),currencyUnit:u(e.currencyUnit,a),elements:M(e.elements,a),skillTypes:M(e.skillTypes,a),weaponTypes:M(e.weaponTypes,a),armorTypes:M(e.armorTypes,a),equipTypes:M(e.equipTypes,a),terms:F(e.terms,a)}),exports.replaceTextByMap=R,exports.replaceTroopData=(e,a)=>({members:e.members,id:e.id,name:e.name,pages:e.pages.map((r=>({conditions:r.conditions,span:r.span,list:O(r.list,a)})))}),exports.replaceTroopTexts=(e,a)=>{const r={pluginCommand:t=>t,scriptCommand:t=>t,replaceText:a};return{members:e.members,id:e.id,name:e.name,pages:e.pages.map((t=>({conditions:t.conditions,span:t.span,list:O(t.list,r)})))}};
