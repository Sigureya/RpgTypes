"use strict";const i=require("./make.cjs3.js"),L=require("./mergeItemsSource.cjs.js"),v=require("./lookupRpgDataKind.cjs.js"),q=require("jsonpath-js"),M=(e,a,t)=>e.reduce((s,n)=>(n.code!==i.CHANGE_ARMORS&&n.code!==i.CHANGE_ITEMS&&n.code!==i.CHANGE_WEAPONS||s.push(J(n,a,t)),s),[]),ye={[i.CHANGE_WEAPONS]:"weapon",[i.CHANGE_ARMORS]:"armor",[i.CHANGE_ITEMS]:"item"},J=(e,a,t)=>{const s=e.parameters[3]===i.OPERAND_DIRECT?{direct:!0,value:e.parameters[2]}:{direct:!1,variableId:e.parameters[2]},n=e.parameters[0]===i.OPERATION_GAIN?a.gain:e.parameters[0]===i.OPERATION_LOSE?a.lose:a.unknown,o=typeof e.parameters[4]=="boolean"?{includesEquip:e.parameters[4]}:{};return{itemKind:ye[e.code],dataId:e.parameters[1],code:e.code,commandNameMZ:t(e.code),operation:n,...o,...s}},fe=e=>!!e,H=(e,a)=>e.pages.map((t,s)=>a(t,s,e)),X=(e,a)=>e.events.filter(fe).flatMap(t=>H(t,a)),ge=e=>e.conditions.itemId>0&&e.conditions.itemValid?{pageCondition:{itemId:e.conditions.itemId}}:{},r=(e,a)=>{const t=e.trimEnd(),s=a.get(t);return s?s.trimEnd():t},x=(e,a,t=`
`)=>i.replaceNote(e.note,s=>r(s.value,a),t),_=(e,a)=>e.map(t=>{switch(t.code){case i.SHOW_MESSAGE:return z(t,a);case i.SHOW_CHOICES:return Q(t,a);case i.SHOW_MESSAGE_BODY:case i.COMMENT_HEAD:case i.COMMENT_BODY:case i.SHOW_SCROLLING_TEXT_BODY:return K(t,a);case i.CHANGE_NAME:case i.CHANGE_NICKNAME:case i.CHANGE_PROFILE:return Z(t,a);default:return t}}),K=(e,a)=>{const t=r(e.parameters[0],a);return{code:e.code,indent:e.indent,parameters:[t]}},z=(e,a)=>{const t=e.parameters[4]?r(e.parameters[4],a):"";return i.makeCommandShowMessage({facename:e.parameters[0],faceIndex:e.parameters[1],background:e.parameters[2],positionType:e.parameters[3],speakerName:t},e.indent)},Z=(e,a)=>{const t=r(e.parameters[1],a);return{code:e.code,indent:e.indent,parameters:[e.parameters[0],t]}},Q=(e,a)=>{const t=e.parameters[0].map(s=>r(s,a));return{code:i.SHOW_CHOICES,indent:e.indent,parameters:[t,e.parameters[1],e.parameters[2],e.parameters[3],e.parameters[4]]}},$=(e,a)=>({params:xe(e.params,a),messages:Te(e.messages,a),commands:be(e.commands,a),basic:he(e.basic,a)}),he=(e,a)=>[r(e[0],a),r(e[1],a),r(e[2],a),r(e[3],a),r(e[4],a),r(e[5],a),r(e[6],a),r(e[7],a),r(e[8],a),r(e[9],a)],be=(e,a)=>[r(e[0],a),r(e[1],a),r(e[2],a),r(e[3],a),r(e[4],a),r(e[5],a),r(e[6],a),r(e[7],a),r(e[8],a),r(e[9],a),r(e[10],a),r(e[11],a),r(e[12],a),r(e[13],a),r(e[14],a),r(e[15],a),r(e[16],a),r(e[17],a),r(e[18],a),r(e[19],a),"",r(e[21],a),r(e[22],a),"",r(e[24],a),r(e[25],a)],xe=(e,a)=>[r(e[0],a),r(e[1],a),r(e[2],a),r(e[3],a),r(e[4],a),r(e[5],a),r(e[6],a),r(e[7],a),r(e[8],a),r(e[9],a)],Te=(e,a)=>({actionFailure:r(e.actionFailure,a),actorDamage:r(e.actorDamage,a),actorDrain:r(e.actorDrain,a),actorGain:r(e.actorGain,a),actorLoss:r(e.actorLoss,a),actorNoDamage:r(e.actorNoDamage,a),actorNoHit:r(e.actorNoHit,a),actorRecovery:r(e.actorRecovery,a),alwaysDash:r(e.alwaysDash,a),autosave:r(e.autosave,a),bgmVolume:r(e.bgmVolume,a),bgsVolume:r(e.bgsVolume,a),buffAdd:r(e.buffAdd,a),buffRemove:r(e.buffRemove,a),commandRemember:r(e.commandRemember,a),counterAttack:r(e.counterAttack,a),criticalToActor:r(e.criticalToActor,a),criticalToEnemy:r(e.criticalToEnemy,a),defeat:r(e.defeat,a),debuffAdd:r(e.debuffAdd,a),emerge:r(e.emerge,a),enemyDamage:r(e.enemyDamage,a),enemyDrain:r(e.enemyDrain,a),enemyGain:r(e.enemyGain,a),enemyLoss:r(e.enemyLoss,a),enemyNoDamage:r(e.enemyNoDamage,a),enemyNoHit:r(e.enemyNoHit,a),enemyRecovery:r(e.enemyRecovery,a),escapeFailure:r(e.escapeFailure,a),escapeStart:r(e.escapeStart,a),evasion:r(e.evasion,a),expNext:r(e.expNext,a),expTotal:r(e.expTotal,a),file:r(e.file,a),loadMessage:r(e.loadMessage,a),levelUp:r(e.levelUp,a),magicEvasion:r(e.magicEvasion,a),magicReflection:r(e.magicReflection,a),meVolume:r(e.meVolume,a),obtainExp:r(e.obtainExp,a),obtainGold:r(e.obtainGold,a),obtainItem:r(e.obtainItem,a),obtainSkill:r(e.obtainSkill,a),partyName:r(e.partyName,a),possession:r(e.possession,a),preemptive:r(e.preemptive,a),saveMessage:r(e.saveMessage,a),seVolume:r(e.seVolume,a),substitute:r(e.substitute,a),surprise:r(e.surprise,a),touchUI:r(e.touchUI,a),useItem:r(e.useItem,a),victory:r(e.victory,a)}),E=(e,a)=>e.map(t=>r(t,a)),ee=e=>e.map(a=>a.parameters[0].trimEnd()).join(`
`).trimEnd();class ae{constructor(a,t){this.header=a,this.bodies=t}getBodyText(){return ee(this.joinCommandBodies())}mergedBody(){return{code:this.header.code,indent:this.header.indent,parameters:[this.getBodyText()]}}joinCommandBodies(){return[this.header,...this.bodies]}normalizedCommands(){return[this.mergedBody()]}}class G{constructor(a,t,s){this.bodyCode=a,this.header=t,this.bodies=s}normalizedCommands(){const a={...this.header,code:this.header.code,indent:this.header.indent,parameters:[...this.header.parameters]};return this.bodies.length===0?[a]:[a,this.mergedBody()]}getBodyText(){return ee(this.bodies)}joinCommandBodies(){return this.bodies}mergedBody(){return{code:this.bodyCode,indent:this.header.indent,parameters:[this.getBodyText()]}}}const O=(e,a,t,s)=>{const n=e[a];if(!t(n))throw new Error(`Invalid head at index ${a}: ${JSON.stringify(n)}`);const o=[];for(let m=a+1;m<e.length;m++){const d=e[m];if(!s(d))break;o.push(d)}return{header:n,bodies:o}},Se=(e,a)=>{const{bodies:t,header:s}=((n,o)=>O(n,o,m=>m.code===i.COMMENT_HEAD,m=>m.code===i.COMMENT_BODY))(e,a);return Ne(s)?new G(i.COMMENT_BODY,s,t):new ae(s,t)},Ne=e=>e.parameters[0]==="選択肢ヘルプ",Ee=(e,a)=>{const{bodies:t,header:s}=((n,o)=>O(n,o,m=>m.code===i.SHOW_MESSAGE,m=>m.code===i.SHOW_MESSAGE_BODY))(e,a);return new G(i.SHOW_MESSAGE_BODY,s,t)},ve=(e,a)=>{const{bodies:t,header:s}=((n,o)=>O(n,o,m=>m.code===i.SCRIPT_EVAL,m=>m.code===i.SCRIPT_EVAL_BODY))(e,a);return new ae(s,t)},_e=(e,a)=>{const{bodies:t,header:s}=((n,o)=>O(n,o,m=>m.code===i.SHOW_SCROLLING_TEXT,m=>m.code===i.SHOW_SCROLLING_TEXT_BODY))(e,a);return new G(i.SHOW_SCROLLING_TEXT_BODY,s,t)},Ae={[i.SHOW_MESSAGE]:(e,a,t)=>t.showMessage(Ee(e,a),a,e),[i.SCRIPT_EVAL]:(e,a,t)=>t.script(ve(e,a),a,e),[i.COMMENT_HEAD]:(e,a,t)=>t.comment(Se(e,a),a,e),[i.SHOW_SCROLLING_TEXT]:(e,a,t)=>t.showScrollingText(_e(e,a),a,e)},P=e=>((a,t)=>({code:a.code,paramIndex:t,value:a.parameters[t]}))(e,1),ke=e=>e.parameters[0].map((a,t)=>({code:102,paramIndex:t,value:a})),F=(e,a)=>te(e,a),te=(e,a)=>e.reduce((t,s,n)=>{if(s.code===i.SHOW_CHOICES)return[...t,...ke(s)];const o=(m=s.code,Ae[m]);var m;if(o){const d=o(e,n,Ie);if(d!==void 0)return[...t,d]}if(s.code===i.CHANGE_NICKNAME)return[...t,P(s)];if(s.code===i.CHANGE_NAME)return[...t,P(s)];if(s.code===i.CHANGE_PROFILE)return[...t,P(s)];if(s.code===i.PLUGIN_COMMAND_MZ){const d=a(s);return d.length===0?t:[...t,...d]}return t},[]),Ie={comment:e=>{return a=e,{code:i.COMMENT_HEAD,paramIndex:0,value:a.getBodyText()};var a},showMessage:e=>{return a=e,{code:i.SHOW_MESSAGE_BODY,paramIndex:0,value:a.getBodyText(),speaker:(t=a.header,t.parameters[4]?t.parameters[4].trimEnd():"")};var a,t},script:e=>(a=>({code:i.SCRIPT_EVAL,paramIndex:0,value:a.getBodyText()}))(e),showScrollingText:e=>(a=>({code:i.SHOW_SCROLLING_TEXT_BODY,paramIndex:0,value:a.getBodyText()}))(e)},Oe=(e,a)=>X(e,(t,s,n)=>({eventId:n.id,pageIndex:s,commands:F(t.list,a),note:n.note,noteItems:i.readNote(n.note),name:n.name})),D=(e,a,t)=>({folder:t,key:a,image:e[a],id:e.id}),f=(e,a)=>({note:re(e),main:a.map(t=>({key:t,text:e[t],id:e.id}))}),re=e=>i.readNoteEx(e.note,(a,t)=>({key:a,text:t,id:e.id})),Ce=(e,a)=>`${a}[${e.map(t=>`"${t.name}"`).join(",")}]`,W={undefinedStruct:"undefined_struct",cyclicStruct:"cyclic_struct"},Me=(e,a,t,s)=>{if(t.scalas.length>0||t.scalaArrays.length>0){const n=((o,{path:m,structName:d})=>{return{arraySchema:v.toObjectPluginParams(o.scalaArrays),objectSchema:v.toObjectPluginParams(o.scalas),structName:d,scalaArrays:(p=o.scalaArrays,S=m,p.map(h=>({path:`${S}.${h.name}[*]`,param:h}))),scalas:o.scalas.length>0?Ce(o.scalas,m):void 0};var p,S})(t,{path:a.basePath,structName:a.schemaName});return{frames:[...e.frames,...s],items:[...e.items,n],errs:e.errs}}return s.length>0?{frames:[...e.frames,...s],items:e.items,errs:e.errs}:e};function V(e,a,t,s){const n={items:[],errs:[],frames:[{schemaName:e,basePath:a,ancestry:[]}]},o=Math.max(1,3*t.size+5),m=Array.from({length:o}).reduce(d=>d.frames.length===0?d:((p,S,h)=>{if(p.frames.length===0)return p;const y=p.frames.pop();if(y.ancestry.includes(y.schemaName))return{frames:p.frames,items:p.items,errs:[...p.errs,{code:h.cyclicStruct,path:y.basePath}]};const b=S.get(y.schemaName);if(!b)return{frames:p.frames,items:p.items,errs:[...p.errs,{code:h.undefinedStruct,path:y.basePath}]};const ue=((C,w)=>{const B=C.ancestry.concat(C.schemaName),R=C.basePath;return[...w.structs.map(N=>({schemaName:N.attr.struct,basePath:`${R}.${N.name}`,ancestry:B})),...w.structArrays.map(N=>({schemaName:N.attr.struct,basePath:`${R}.${N.name}[*]`,ancestry:B}))].reverse()})(y,b);return Me(p,y,b,ue)})(d,t,s),n);return{items:m.items,errors:m.errs}}const Pe=(e,a,t)=>e.reduce((s,{segments:n,value:o})=>{if(typeof o=="object")return s;const m=n[n.length-1];if(typeof m=="number")return s;const d=a.objectSchema[m];if(!d)return s;const p={value:o,structName:t,param:{name:m,attr:d}};return[...s,p]},[]),De=e=>(e.data.kind==="struct_def"||e.data.kind==="struct_def[]")&&!!e.data.struct,se=(e,a)=>({type:"array",items:a,...l(e),...u(e.default)}),l=e=>({...typeof e.text=="string"?{title:e.text}:{},...typeof e.desc=="string"?{description:e.desc}:{}}),u=e=>e!==void 0?{default:e}:{},He="x-rpg-param",T=(e,a)=>({[He]:{kind:e.kind,...e.parent?{parent:e.parent}:{},data:a}}),Fe=e=>T(e,{...typeof e.on=="string"?{on:e.on}:{},...typeof e.off=="string"?{off:e.off}:{}}),k=e=>e===void 0||e===0,Y=e=>T(e,typeof e.decimals=="number"?{decimals:e.decimals}:{}),ne=e=>({$ref:`#/definitions/${e.struct}`,...l(e)}),oe=e=>se(e,{type:"string"}),ie=e=>se(e,{type:"integer"}),j=e=>{switch(e.kind){case"string":case"multiline_string":return(a=>({type:"string",...l(a),...u(a.default)}))(e);case"file":case"combo":return(a=>({type:"string",...u(a.default),...l(a)}))(e);case"select":return(a=>({type:"string",...u(a.default),...l(a),...a.options?{enum:a.options.map(t=>t.value)}:{}}))(e);case"file[]":case"string[]":case"multiline_string[]":return oe(e);case"number[]":return(a=>({type:"array",items:{type:k(a.decimals)?"integer":"number"},...u(a.default),...l(a)}))(e);case"actor[]":case"weapon[]":case"armor[]":case"skill[]":case"item[]":case"enemy[]":case"state[]":case"class[]":case"troop[]":return ie(e);case"number":return(a=>({type:k(a.decimals)?"integer":"number",...u(a.default),...l(a)}))(e);case"actor":case"weapon":case"armor":case"skill":case"item":case"enemy":case"state":case"class":case"troop":return(a=>({type:"integer",...u(a.default),...l(a)}))(e);case"boolean":return(a=>({type:"boolean",...u(a.default),...l(a)}))(e);case"struct":return ne(e);default:return{}}},me=e=>{switch(e.kind){case"string":case"multiline_string":return(a=>({type:"string",...l(a),...u(a.default),...T(a,{})}))(e);case"file":return(a=>({type:"string",...u(a.default),...l(a),...T(a,{dir:a.dir})}))(e);case"combo":return(a=>({type:"string",...u(a.default),...l(a),...T(a,{options:[...a.options]})}))(e);case"select":return(a=>({type:"string",...u(a.default),...l(a),enum:a.options.map(t=>t.value),...T(a,{options:a.options.map(t=>({value:t.value,option:t.option}))})}))(e);case"file[]":case"string[]":case"multiline_string[]":return oe(e);case"number[]":return(a=>({type:"array",items:{type:k(a.decimals)?"integer":"number"},...u(a.default),...l(a),...Y(a)}))(e);case"actor[]":case"weapon[]":case"armor[]":case"skill[]":case"item[]":case"enemy[]":case"state[]":case"class[]":case"troop[]":return ie(e);case"number":return(a=>({type:k(a.decimals)?"integer":"number",...u(a.default),...l(a),...Y(a)}))(e);case"actor":case"weapon":case"armor":case"skill":case"item":case"enemy":case"state":case"class":case"troop":return(a=>({type:"integer",...u(a.default),...l(a),...T(a,v.lookupKind(a.kind))}))(e);case"boolean":return(a=>({type:"boolean",...u(a.default),...l(a),...Fe(a)}))(e);case"struct":return ne(e);default:return{}}},U=e=>{const a=Object.entries(e).reduce((t,[s,n])=>{const o=j(n);return{...t,[s]:o}},{});return{type:"object",properties:a,required:Object.keys(a),additionalProperties:!1}},A=(e,a,t,s)=>{const{properties:n,logs:o}=Ge(t,e,s);return{schema:{type:"object",title:a,properties:n,required:Object.keys(t),additionalProperties:!1},logs:o}},ce=e=>e.kind==="struct_def",de=e=>e.kind==="struct_def[]",Ge=(e,a,t)=>Object.entries(e).reduce((s,n)=>((o,[m,d],p,S)=>{const h=`${p}.${m}`,y=je(h,d,S);return{properties:{...o.properties,[m]:y.schema},logs:[...o.logs,...y.logs,{structName:(b=d,de(b)||ce(b)?b.struct:""),path:h,data:d,schema:y.schema}]};var b})(s,n,a,t),{properties:{},logs:[]}),je=(e,a,t)=>ce(a)?pe(e,a,t):de(a)?we(e,a,t):{schema:t.options.kindData?me(a):j(a),logs:[]},pe=(e,a,t)=>A(e,a.struct,a.params,t),we=(e,a,t)=>{const s=pe(`${e}[]`,{params:a.params,struct:a.struct},t);return{schema:{type:"array",...s.schema?{items:s.schema}:{},...u(a.default)},logs:s.logs}},c={type:"string",nullable:!0,maxLength:100},g={type:"string",default:"",nullable:!1},I={type:"number",nullable:!0},Be={additionalProperties:!1,type:"object",required:["kind","default"],properties:{kind:{type:"string",const:"boolean"},default:{type:"boolean",default:!0},on:c,off:c,desc:c,text:c,parent:c}},Re={type:"object",required:["kind","default"],properties:{decimals:{type:"integer",minimum:0,default:0,nullable:!0},min:I,max:I,default:{type:"number",default:0},kind:{type:"string",const:"number"},desc:c,text:c,parent:c}},Le={additionalProperties:!1,type:"object",required:["kind","default"],properties:{kind:{type:"string",const:"number[]"},default:{type:"array",items:{type:"number",default:0},default:[]},decimals:{type:"integer",minimum:0,default:0,nullable:!0},min:I,max:I,desc:c,text:c,parent:c}},qe={additionalProperties:!1,type:"object",required:["kind","default"],properties:{kind:{type:"string",const:"string"},default:g,desc:c,text:c,parent:c}},$e={additionalProperties:!1,type:"object",required:["kind","default"],properties:{kind:{type:"string",const:"string[]"},default:{type:"array",items:g,default:[]},desc:c,text:c,parent:c}},We={additionalProperties:!1,type:"object",required:["kind","default"],properties:{kind:{type:"string",enum:["actor","class","skill","item","weapon","armor","enemy","state","common_event"]},default:{type:"integer",default:0},desc:c,text:c,parent:c}},Ve={additionalProperties:!1,type:"object",required:["kind","default","options"],properties:{kind:{type:"string",const:"combo"},default:g,options:{type:"array",items:{type:"string"},default:[]},desc:c,text:c,parent:c}},Ye={additionalProperties:!1,type:"object",required:["kind","default","dir"],properties:{kind:{type:"string",const:"file"},default:g,dir:g,desc:c,text:c,parent:c}},Ue={additionalProperties:!1,type:"object",required:["kind","default","dir"],properties:{kind:{type:"string",const:"file[]"},default:{type:"array",items:{type:"string"},default:[]},dir:g,desc:c,text:c,parent:c}},le={type:"string",pattern:"^[a-zA-Z][a-zA-Z0-9]*$",minLength:1,maxLength:48},Je={additionalProperties:!1,type:"object",required:["kind","struct"],properties:{kind:{type:"string",const:"struct"},default:{type:"object",default:{},nullable:!0},desc:c,text:c,parent:c,struct:le}},Xe={additionalProperties:!1,type:"object",required:["kind","struct"],properties:{kind:{type:"string",const:"struct[]"},struct:le,default:{type:"array",items:{type:"object"},default:[],nullable:!0},desc:c,text:c,parent:c}},Ke={additionalProperties:!1,type:"object",required:["kind","default","options"],properties:{kind:{type:"string",const:"select"},default:g,options:{type:"array",items:{type:"object",properties:{value:g,option:g},required:["value","option"]},default:[]},desc:c,text:c,parent:c}};exports.buildReferenceItemSources=(e,a,t,s,n,o)=>[...i.defineTraitItems(t,s),...i.defineGameDataSources(e,a),...i.defineSystemItems(n,o)],exports.compileFlatStruct=U,exports.compileItemEffectDisplayData=(e,a,t)=>{const s=i.resolveItemEffectLabels(a);return L.mergeItemsSource(t?[...s,...t]:s,e)},exports.compilePluginCommand=(e,{args:a,command:t},s)=>A(`${e.moduleName}.command.${t}`,t,a,{options:s}),exports.compilePluginStruct=(e,{params:a,struct:t},s)=>A(`${e.moduleName}.${t}`,t,a,{options:s}),exports.compilePrimitiveField=j,exports.compilePrimitiveFieldWithXParam=me,exports.compileStructDetail=A,exports.compileTraitDisplayData=(e,a)=>L.mergeItemsSource(i.resolveTraitLabels(a),e),exports.defineStructs=e=>e.filter(a=>De(a)).reduce((a,t)=>({...a,[t.structName]:t.schema}),{}),exports.extractArrayValuesFromJson=(e,a)=>a.scalaArrays.map(t=>((s,n)=>{const o=new q.JSONPathJS(n.path).find(s);if(!Array.isArray(o))return null;const m=n.param.attr;return v.isStringArrayParam(m)?{values:o.filter(d=>typeof d=="string"),valueKind:"string",param:{name:n.param.name,attr:m}}:v.isNumberArrayParam(m)?{values:o.filter(d=>typeof d=="number"),valueKind:"number",param:{name:n.param.name,attr:m}}:null})(e,t)).filter(t=>t!==null),exports.extractBattleEventTexts=(e,a=()=>[])=>((t,s)=>t.map(n=>H(n,s)))(e,(t,s,{id:n})=>({eventId:n,pageIndex:s,commands:F(t.list,a)})),exports.extractCommonEventTexts=(e,a=()=>[])=>{return t=(s,n,{id:o})=>({eventId:o,commands:F(s.list,a)}),e.map(s=>t(s,0,s));var t},exports.extractImageFromActor=e=>[D(e,"faceName","faces"),D(e,"characterName","characters"),D(e,"battlerName","sv_actors")],exports.extractImageFromEnemy=e=>({key:"battlerName",image:e.battlerName,id:e.id}),exports.extractItemChangeData=J,exports.extractItemCommands=M,exports.extractItemFromMap=(e,a,t)=>X(e.map,(s,n,o)=>({...ge(s),commands:M(s.list,a,t),eventName:o.name,pageIndex:n})),exports.extractItemFromTroop=(e,a,t)=>{return s=(n,o,m)=>({commands:M(n.list,a,t),eventName:m.name,troopId:m.id,pageIndex:o}),e.flatMap(n=>H(n,s));var s},exports.extractMapText=(e,a=()=>[])=>({note:e.note,noteItems:i.readNote(e.note),displayedName:e.displayName,events:Oe(e,a)}),exports.extractNoteText=re,exports.extractScalaValuesFromJson=(e,a)=>{if(!a.scalas)return[];const t=new q.JSONPathJS(a.scalas).pathSegments(e);return Pe(t,a,a.structName)},exports.extractTextData=f,exports.extractTextFromActor=e=>f(e,["name","nickname","profile"]),exports.extractTextFromArmor=e=>f(e,["name","description"]),exports.extractTextFromClass=e=>f(e,["name"]),exports.extractTextFromEnemy=e=>f(e,["name"]),exports.extractTextFromEventCommands=e=>te(e,()=>[]),exports.extractTextFromItem=e=>f(e,["name","description"]),exports.extractTextFromSkill=e=>f(e,["name","description","message1","message2"]),exports.extractTextFromState=e=>f(e,["name","message1","message2","message3","message4"]),exports.extractTextFromSystem=e=>({gameTitle:e.gameTitle,currencyUnit:e.currencyUnit,equipTypes:[...e.equipTypes],armorTypes:[...e.armorTypes],weaponTypes:[...e.weaponTypes],terms:{basic:i.makeTermsBasicFromArray(e.terms.basic),commands:i.makeTermsCommandFromArray(e.terms.commands),messages:i.makeTermsMessages(e.terms.messages),params:i.makeParamNamesFromArray(e.terms.params)}}),exports.extractTextFromWeapon=e=>f(e,["name","description"]),exports.getPathFromStructParam=function(e,a,t,s=W){const n=e.map(o=>V(o.attr.struct,`${a}.${o.name}`,t,s));return{items:n.flatMap(o=>o.items),errors:n.flatMap(o=>o.errors)}},exports.getPathFromStructSchema=function(e,a,t,s=W){return V(e,a,t,s)},exports.makePluginParamSchema=()=>({type:"object",discriminator:{propertyName:"kind"},oneOf:[Be,Ve,We,Ye,Ue,Re,Le,Ke,Je,Xe,qe,$e]}),exports.replaceActorText=(e,a)=>{const t=x(e,a),s=r(e.name,a),n=r(e.nickname,a),o=r(e.profile,a);return{...e,name:s,nickname:n,profile:o,note:t}},exports.replaceClassText=(e,a)=>{const t=x(e,a),s=r(e.name,a);return{...e,name:s,note:t}},exports.replaceCommonEventTexts=(e,a)=>({...e,list:_(e.list,a)}),exports.replaceEnemyText=(e,a)=>{const t=x(e,a),s=r(e.name,a);return{...e,name:s,note:t}},exports.replaceEventCommandTexts=_,exports.replaceItemText=(e,a)=>{const t=x(e,a),s=r(e.name,a),n=r(e.description,a);return{...e,name:s,description:n,note:t}},exports.replaceMapDataTexts=(e,a)=>{const t=r(e.displayName,a),s=x(e,a),n={displayName:t,events:i.repleaceMapEventCommands(e,o=>_(o,a)),note:s};return{...e,...n}},exports.replaceNoteTextByMap=x,exports.replaceSkillText=(e,a)=>{const t=x(e,a),s=r(e.name,a),n=r(e.description,a),o=r(e.message1,a),m=r(e.message2,a);return{...e,name:s,description:n,message1:o,message2:m,note:t}},exports.replaceStateText=(e,a)=>{const t=x(e,a),s=r(e.name,a),n=r(e.message1,a),o=r(e.message2,a),m=r(e.message3,a),d=r(e.message4,a);return{...e,name:s,message1:n,message2:o,message3:m,message4:d,note:t}},exports.replaceSystemTerms=$,exports.replaceSystemText=(e,a)=>({...e,gameTitle:r(e.gameTitle,a),currencyUnit:r(e.currencyUnit,a),elements:E(e.elements,a),skillTypes:E(e.skillTypes,a),weaponTypes:E(e.weaponTypes,a),armorTypes:E(e.armorTypes,a),equipTypes:E(e.equipTypes,a),terms:$(e.terms,a)}),exports.replaceTextByMap=r,exports.replaceTextForCommand=K,exports.replaceTextForCommandActor=Z,exports.replaceTextForCommandShowChoices=Q,exports.replaceTextForCommandShowMessage=z,exports.replaceTroopTexts=(e,a)=>{const t=e.pages.map(s=>({list:_(s.list,a),conditions:s.conditions,span:s.span}));return{...e,pages:t}},exports.structToJSONSchema=e=>U(e);
